# PHR-001: ChatKit Comprehensive Analysis

## Metadata
- **ID**: PHR-001
- **Stage**: misc (analysis)
- **Feature**: phase3-chatbot
- **Date**: 2026-01-12
- **Title**: ChatKit Comprehensive Analysis

---

## Prompt (Verbatim)

```
first analyze first the OpenAi Chatkit, frontend, backend, ports, api, endpoints, server, playwright setups everywhere in phase, and related things with OpenAi chatkit, chck errors, bugs, dublicate, conflict, unnecessary files and folders with there specific and specialized sub-agents, domain specific skills, and with related MCPs
```

---

## Response Summary

Conducted comprehensive multi-agent analysis of the OpenAI ChatKit integration across phase-3-chatbot:

### Key Findings

**Critical Issues (6)**:
1. `service.get_tasks()` called but method is `list_tasks()` (chatkit.py:53)
2. `load_thread_items()` missing required args (server.py:177-182)
3. `thread_items.data` should be `thread_items.items` (server.py:183)
4. Invalid IP in .env: `BACKEND_HOST=0.0.0.0.1`
5. Exposed API keys in `.env.local` files
6. Exposed Vercel OIDC token in frontend `.env.local`

**High Priority Issues (8)**:
- String task_id vs UUID type mismatch
- String priority vs Priority enum mismatch
- datetime serialization not applied to ThreadMetadata
- Empty GEMINI_API_KEY with no validation
- Hardcoded Vercel domain in CORS config
- Duplicate proxy route handlers
- Missing BACKEND_URL fallbacks in auth.ts/chat.ts
- Orphaned test file in wrong directory

**Architecture Conflicts**:
- Two competing chat implementations: `/api/v1/chat` (Agents SDK) vs `/api/v1/chatkit` (ChatKit SDK)
- Tool schemas defined in two places
- 7 unused custom chat components (dead code)

**Files to Delete**: 9 unnecessary/backup/duplicate files

**Port Conflicts**: None detected (3000, 8000, 5432 all clear)

### Agents Used
1. **backend-builder**: Analyzed ChatKit store, server, endpoint, router
2. **ux-frontend-developer**: Analyzed frontend integration, proxy routes, dead code
3. **qa-overseer**: Analyzed Playwright test setup, selectors, config
4. **Explore (x2)**: Port/env configuration, duplicate file detection

---

## Artifacts

- Analysis report generated in conversation
- Reports generated by agents:
  - `specs/reports/chatkit-frontend-analysis.md`
  - `specs/reports/chatkit-issues-summary.md`

---

## Next Steps

1. Fix critical bugs before testing (B1-B3, C2)
2. Remove exposed credentials (S1, S2)
3. Choose canonical chat implementation
4. Delete unnecessary files
5. Update .gitignore

---

## Tags

`analysis`, `chatkit`, `openai`, `phase3`, `bugs`, `security`, `architecture`
